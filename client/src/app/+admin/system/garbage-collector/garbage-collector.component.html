
<div *ngIf="hasError" class="py-3 d-flex justify-content-center align-items-center">
    Error, could not fetch garbage collector data
</div>

<div *ngIf="!gbRuns && !hasError" class="py-3 d-flex justify-content-center align-items-center">
    Loading...
</div>

<div *ngIf="gbRuns && !hasError">

    <div class="progress" i18n-title title="Garbage collector progress">
        <div class="progress-bar" role="progressbar" [style.width.%]="(gbRuns && gbRuns.length > 0 && gbRuns[0].state == garbageCollectorRunningState) ? gbRuns[0].progress : 0"
            [attr.aria-valuenow]="(gbRuns && gbRuns.length > 0 && gbRuns[0].state == garbageCollectorRunningState) ? gbRuns[0].progress : 0" aria-valuemin="0" [attr.aria-valuemax]="100">
        </div>
        <span>{{ (gbRuns && gbRuns.length > 0 && gbRuns[0].state == garbageCollectorRunningState) ? gbRuns[0].progress : 0 }}</span>
        <span>100</span>
    </div>

    <div class="py-4 d-flex justify-content-center align-items-center">
        <div *ngIf="gbRuns.length > 0 && gbRuns[0].state == garbageCollectorRunningState">
            Garbage collector is running...
        </div>
        <div *ngIf="!(gbRuns.length > 0 && gbRuns[0].state == garbageCollectorRunningState)">
            <button *ngIf="!isExecuting" (click)="executeGarbageCollector()">Execute</button>
        </div>
    </div>

    <div id="gbHistory">
        <table *ngIf="gbRuns && gbRuns.length > 0" class="table table-hover">
            <tr class="d-flex">
                <th class="d-flex align-items-center" style="width: 25%">
                    Started on
                </th>
                <th class="d-flex justify-content-center align-items-center" style="width: 15%">
                    Status
                </th>
                <th class="d-flex justify-content-center align-items-center" style="width: 40%">
                    Result
                </th>
                <th class="d-flex justify-content-center align-items-center" style="width: 20%">
                    Finished on
                </th>
            </tr>
            <tr *ngFor="let gbRun of gbRuns" class="d-flex">
                <td class="d-flex align-items-center" style="width: 25%">
                    {{gbRun.createdAt | date:'medium' }}
                </td>
                <td class="d-flex justify-content-center align-items-center" style="width: 15%"
                    [ngClass]="{'text-danger': gbRun.state == garbageCollectorFailedState, 'text-success': gbRun.state == garbageCollectorCompleteState, 'text-info': gbRun.state == garbageCollectorRunningState}">
                    {{GARBAGE_COLLECTOR_STATES[gbRun.state]}}
                </td>
                <td class="d-flex justify-content-center align-items-center" style="width: 40%">
                    <span *ngIf="gbRun.error">{{gbRun.error}}</span>
                    <span *ngIf="gbRun.state == garbageCollectorCompleteState">
                        Found <a [routerLink]="" (click)="openModalListVideos(gbRun)">{{gbRun.nbVideos}} video(s)</a>
                    </span>
                </td>
                <td class="d-flex justify-content-center align-items-center" style="width: 20%">
                    {{gbRun.finishedOn | date:'medium' }}
                </td>
            </tr>
        </table>
    </div>

    <div *ngIf="nbPages > 1">
        <div class="d-flex justify-content-center align-items-center">
            Page {{ currentPage + 1 }} / {{ nbPages }}
        </div>
        <div *ngIf="!isRequesting" class="d-flex justify-content-center align-items-center">
            <button (click)="changePage(-1)" [disabled]="currentPage <= 0" class="mx-1">Previous</button>
            <button (click)="changePage(1)" [disabled]="currentPage >= (nbPages - 1)" class="mx-1">Next</button>
        </div>
        <div *ngIf="isRequesting" class="d-flex justify-content-center align-items-center">
            <my-small-loader [loading]="isRequesting"></my-small-loader>
        </div>
    </div>

</div>

<my-list-videos-modal #listVideosModal></my-list-videos-modal>